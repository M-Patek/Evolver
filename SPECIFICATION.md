# HYPER-TENSOR PROTOCOL (HTP): Technical Specification

"Time is Evolution, Space is Projection."

## 1. Mathematical Preliminaries

### 1.1 Class Group Parameters & The Unknown Order

**Discriminant Generation:**
Define the discriminant $\Delta$ as a hash-derived parameter:

$$\Delta = -M$$

where $M$ is a large prime number (e.g., 2048-bit) derived deterministically from the ContextHash satisfying $M \equiv 3 \pmod 4$.

**The Open Secret:**
While $\Delta$ is public, the group structure of $Cl(\Delta)$ remains opaque. Specifically, the Class Number $h(\Delta)$ (the order of the group) is computationally infeasible to calculate for large discriminants (Cohen-Lenstra Heuristics).

**Security Consequence:**
The hardness of computing $h(\Delta)$ ensures that the group acts as a Group of Unknown Order. This prevents attackers (and the generator) from using Lagrange's Theorem ($g^{|G|} = 1$) to compute shortcuts for exponentiation.

### 1.2 Algebraic Dynamics (Dynamical Decoupling)

To reconcile the requirement for local search (Optimization) with the requirement for sequential hardness (Security), the protocol explicitly decouples the Search Dynamics from the Observation Dynamics.

**1. Search Dynamics (The Will's Walk):**
The Optimizer (Will) operates on the Cayley Graph without time-evolution to preserve the Lipschitz metric structure required for convergence.

$$S_{k+1} = S_k \circ \epsilon_k$$

Here, $S$ represents the "Seed of the Moment". The search moves to adjacent nodes to minimize the potential energy of the entire future path generated by this seed.

**2. Observation Dynamics (The Arrow of Time):**
To materialize a logical path from a candidate seed $S$, we apply the VDF (Squaring) to generate a temporal sequence (Orbit).

$$\mathcal{O}(S) = [ S_0, S_1, \dots, S_T ] \quad \text{where } S_{t+1} = S_t^2$$

The logical projection $\Psi$ is then applied to this temporal sequence:

$$\text{Path} = [ \Psi(S_0), \Psi(S_1), \dots, \Psi(S_T) ]$$

**Why this distinction?**

* **Search** must be locally continuous (Small $\epsilon \implies$ Small $\Delta E$).
* **Time** must be chaotic and irreversible (Squaring prevents forgery).

---

## 2. Affine Evolution & Optimization (The Soul & Will)

### 2.1 The Algebraic State (Soul)

The state $S \in Cl(\Delta)$ is defined as an equivalence class of binary quadratic forms $[a, b, c]$.

### 2.2 The Will's Loop (Search)

Implemented in `src/will/optimizer.rs`.

* **Input:** Current Seed Candidate $S_{seed}$.
* **Action:** The Will selects a perturbation $\epsilon \in \mathcal{P}$ (Generator Set) to navigate the Cayley Graph.

$$S_{new} = S_{seed} \circ \epsilon$$

* **Evaluation:** To evaluate $S_{new}$, the system momentarily "unfolds" the time dimension (computes $S_{new}^2, S_{new}^4 \dots$) to check if the resulting logical path satisfies the STP constraints.
* **Dynamics:** The optimizer searches for a Seed $S^*$ such that its temporal unfolding yields a Zero-Energy logic path.

### 2.3 Materialization (The Body's Projection)

Implemented in `src/body/decoder.rs` and `src/body/adapter.rs`.

* **Input:** The optimized seed $S^*$.
* **Process:**
    1.  Generate algebraic orbit: 
        $$S_0 = S^*, S_1 = S_0^2, \dots, S_k = S_{k-1}^2$$
    2.  Apply Affine Projection $\Psi$ to each state in the orbit.
    3.  Apply Semantic Adapter to convert the sequence of digits into a Proof.
* **Output:** A sequence of logical action IDs $d_1, d_2, \dots, d_k$.

---

## 3. Hyper-Tensor Topology (v-PuNN)

### 3.1 Coordinate Mapping

Define a mapping $\Psi$ from the algebraic state $S$ to a logical digit $d$:

$$\Psi(S) = (a + b) \pmod{P}$$

*(Note: The sequence index $k$ previously used in $\Psi_k$ is now naturally handled by the Time Evolution $S \to S^2$, so the projection function itself can remain static.)*

This projection preserves the Lipschitz continuity of the algebraic manifold locally, allowing local search algorithms (like VAPO) to function effectively on the Seed state.

### 3.2 Orthogonal Verification

The HTP protocol requires that generated logic must be consistent. The STP engine verifies the logical validity of the materialized path.

$$E_{STP}(\text{Materialize}(S^*)) == 0$$

---

## 4. Proof of Will & Security Model

### 4.1 The Security Goal: Unforgeability

The goal of HTP security is not to hide the logic, but to prove that the logic was generated through computational effort (Search) rather than hallucinated or pre-computed via shortcuts.

### 4.2 Proof Bundle (The Artifact)

The output of the system is a verifiable artifact:

$$\text{ProofBundle} := \{ \mathbf{H}_{ctx}, S_{final}, \text{Trace}_{\epsilon} \}$$

* $\mathbf{H}_{ctx}$: Context Hash (anchors $\Delta$).
* $S_{final}$: The result seed state.
* $\text{Trace}_{\epsilon}$: The sequence of perturbations $[\epsilon_1, \epsilon_2, \dots, \epsilon_k]$ applied to reach the seed.

### 4.3 Verification (Replay)

The Verifier performs the following steps:

1.  **Derive:** Recompute $\Delta$ from $\mathbf{H}_{ctx}$.
2.  **Replay Search:** Starting from Identity, apply the perturbations to reconstruct the Seed $S^*$.
3.  **Replay Time:** Unfold the time orbit 
    $$S^* \to (S^*)^2 \dots$$
4.  **Check:** Verify that the resulting path yields $E_{STP} == 0$.

### 4.4 Why this is "Secure"? (The Hardness Assumptions)

* **Search Hardness:** Finding a seed $S^*$ that unfolds into a valid logic path is a constrained satisfaction problem on a chaotic graph.
* **Time Hardness:** Even if one knows the logic path, reverse-engineering the algebraic seed $S^*$ that generates it is equivalent to inverting the projection and the squaring (root extraction), both of which are hard in unknown order groups.

---

## 5. Conclusion

The HTP v1.5 specification defines a Decoupled Proof-of-Will protocol:

* **Algebra:** Unknown Order Class Groups ($Cl(\Delta)$).
* **Search:** Local traversal on the Cayley Graph (Will).
* **Time:** Deterministic VDF expansion (Squaring).
* **Truth:** A Seed discovered by the Will that withstands the test of Time.
